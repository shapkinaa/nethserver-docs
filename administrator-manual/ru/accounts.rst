.. _users_and_groups-section:

================
Пользователи и группы
================

Пользователи
=====

Системный пользователь должен иметь доступ к большинству сервисов, предоставляемых 
|product| (email, shared folders, etc..).

Каждый пользователь характеризуется парой - имя пользователя и пароль. Вновь создаваемая 
учетная запись пользователя остается заблокированой, до момент установки пароля. Заблокированный
пользователь не может использовать сервисы серверы требующие аутентификации.

При создании пользователя следующие поля учетной записи обязательны к заполнению:

* Username (имя пользователя)
* Name (Имя)
* Surname (Фамилия)

Не обязательные поля:

* Company (Компания)
* Office (Комната)
* Address (Улица)
* City (Город)
* Phone (Телефон)


После создания, учетная запись пользователя заблокирована. Для ее разблокировки необходимо установить пароль с помощью кнопки
:guilabel:`Change password`.
Для смены собственного пароля, пользователь может воспользоваться разделом :ref:`user_profile-section` веб интерфейса Server Manager.
Смену пароля может осуществить только разблокированный пользователь.

Для добавления пользователя в одну или несколько группу необходимо воспользоваться разделом :guilabel:`Users` или :guilabel:`Groups`.

Иногда требуется заблокировать доступ пользователя к сервисам сервера без удаления учетной записи.
Для этого служат кнопки :guilabel:`Lock` и :guilabel:`Unlock`.


.. note:: При удалении пользователя, все данные пользователя будут также удалены.

.. _users_services-section:

Доступ к сервисам
------------------

После создания пользователя, можно указать, к каким сервис он будет иметь доступ.
Это производиться на странице :guilabel:`Services`.

.. _groups-section:

Группы
======

Пользовательские группы могут использоваться для присвоения специальных прав доступа пользователям, а также для создания листов рассылки (с помощью электронной почты).

Как и для пользователей, группам возможно разрешить использование как нескольких, так и всех сервисов.

.. tip:: Для назначения прав доступа в Server Manager, необходимо воспользоваться группами ``managers`` или ``administrators``.

Для организации доступа к панелям веб интерфейса Server Manager следует создать две специальные группы - ``managers`` или ``administrators``.

* :dfn:`administrators`: Пользователям этой группы будут предоставлены такие же права как и пользователя root или пользователю admin.
* :dfn:`managers`: Пользователям, входящим в эту группу предоставляется доступ к функциям управления.


.. _admin_user-section:

Учетная запись администратора
=============

Страница :guilabel:`Users` по умолчанию имеет одну запись: :dfn:`admin`. Эта 
учетная запись имеет доступ к веб интерфейсу Server Manager с такими же правами, что и пользователь
:dfn:`root`. Первоначально учетная запись :dfn:`admin` заблокирована и не имеет доступа к консоли.

.. tip:: Для разблокировки ``admin`` необходимо ей установить пароль.

Эта учетная запись ``admin`` используется для предоставления прав в специфичных сервисах,
таких как :ref:`Подключение рабочей станции к домену Samba <samba_pdc>`

Управление паролями
===================

На пароль в система накладываются следующие ограничения - сложность (:dfn:`complexity`) и время жизни (:dfn:`expiration`).

Политику, накладываемую на пароли, можно изменить в веб интерфейсе модуля ``nethserver-password``, сразу после установки.

Сложность
-----------

Сложность :index:`password` - это минимальный набор условий, удовлетворяя которым он будет принят системой: 
Имеется возможность выбора сложности пароли между двумя различными политиками:

* :dfn:`none`: пароль должен состоять минимум из 7 символов, остальные условия не предъявляются
* :dfn:`strong`

Политика :index:`strong` состоит из следующего набора правил:

* Минимальная длина пароля - 7 символов
* Пароль должен содержать как минимум 1 цифру
* Пароль должен содержать как минимум 1 символ в нижнем регистре
* Пароль должен содержать как минимум 1 символ в верхнем регистре
* Пароль должен содержать как минимум 1 специальный символ
* Пароль должен содержать как минимум 5 различных символ
* Пароль должен отсутствовать в словаре частоупотребляемых слов
* Пароль должен отличаться от имени пользователя
* Пароль не может повторять рисунка для трёх и более символов (на пример, пароль - As1.$ AS1. $ системой принят не будет)

Политика по умолчанию - :dfn:`strong`.

.. warning:: Изменение политики по умолчанию не крайне рекомендовано. Использование простого пароля часто ведет к уязвимости сервера для внешних атак.

Установка политики none ::

  config setprop passwordstrength Users none

Установка политики strong ::

  config setprop passwordstrength Users strong

Проверка текущей установленной политики на сервере ::

  config getprop passwordstrength Users

Время жизни пароля
----------

По умолчанию значение параметра :index:`Время жизни пароля` установлено равное 6 месяцам.
По истечение этого срока, системой будет направлено электронное письмо пользователю о необходимости смены пароля.

.. note:: Для неактивированных пользователей, срок жизни считается от даты последней смены пароля
   и при активации учетной записи, система вышлет письмо с указанием времени жизни пароля.
   В этом случае необходимо изменить пароль.
   К примеру, если датой последней смены пароля считается январь, а активации - октябрь, то система
   будет считать истекшим пароль измененный в январе и попросит сменить его.
   

Для отключения ограничения времени жизни пароля (а также разрешения доступа пользователей с истекшим паролем) служат следующие команды ::

  config setprop passwordstrength PassExpires no
  signal-event password-policy-update

Для отключения ограничения времени жизни пароля для конкретного пользователя следует применить следующие команды ::

  db accounts setprop <username> PassExpires no
  signal event password-policy-update


Представленные ниже команды позволяют посмотреть примененные политики.

Максимальное количество дней, в течение которых нельзя повторять пароль из ранее используемых ::

  config getprop passwordstrength MaxPassAge


Минимальное количество дней, в течении которых можно использовать один пароль ::

  config getprop passwordstrength MinPassAge


Количество дней, в течении которых будет приходить напоминание о смене пароля ::

  config getprop passwordstrength PassWarning


Указывая в конце команды нужное значение и используя команду :command:`setprop` вместо :command:`getprop` можно изменять необходимые параметры. Для того чтобы измененный параметр был применен системой необходимо ввести команду::

  signal-event password-policy-update



На пример, для изменения количества дней, в течении которых будет приходить письмо о необходимости смены пароля следует воспользоваться командой ::

 config setprop passwordstrength PassWarning 5
 signal-event password-policy-update



Влияние времени жизни пароля
^^^^^^^^^^^^^^^^^^^^^^^^^^^

После истечения времени жизни пароля, пользователь сможет получить доступ на чтение и отправку писем, но не получит доступ к общим папкам и принтерам Samba сервера, а также компьютерам, если они являются частью домена. 


Доменный пароль
----------------

Если система сконфигурирована как контроллер домена, то пользователь может изменять свои пароль с помощью Windows утилит.

В этом случае, пользователь не сможет установить пароль длиной менее 6 *символов*, в независимости от политик сервера, так как Windows осуществляет первичную проверку пароля и только потом отсылает его на сервер, для проверки на соответствие политикам сервера.

Язык оповещений
=====================

По умолчанию язык оповещений - английский.
Для смены языка необходимо воспользоваться командой: ::

  config setprop sysconfig DefaultLanguage <lang>

На пример, для смены на итальянский: ::

  config setprop sysconfig DefaultLanguage it_IT.utf8

Импорт пользователей
============

Импорт пользователей осуществляется с помощью файлов CSV.
Файл должен состоять из параметров пользователей (по одной линии на каждого пользователя), с табуляцией в качестве разделителя полей, и удовлетворять следующему формату: ::

 имяпользователя    имя    фамилия    email    пароль

На пример: ::

  mario   Mario   Rossi   mario@example.org       112233


После того как убедитесь, что почтовый сервис запущен, запустите следующую команду: ::

  /usr/share/doc/nethserver-directory-<ver>/import_users <youfilename>

На пример, если файл с данными пользователей - :file:`/root/users.csv`, запустите команду: ::

  /usr/share/doc/nethserver-directory-`rpm --query --qf "%{VERSION}" nethserver-directory`/import_users /root/users.csv


Команда может быть запущена несколько раз, уже созданные учетные записи будут пропущены. 

.. note:: Команда завершится с ошибкой, если не установлен модуль почтового сервиса
